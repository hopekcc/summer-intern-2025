
{% extends 'base.html' %}
{% block title %}Create Room{% endblock %}

{% block content %}
<section style="max-width:640px;margin:2rem auto;">
  <h2>Create a New Room</h2>

  {% if not user %}
    <p style="color:#d00;">Tip: You’re not signed in. You can still create a demo room, but host-lock and history won’t be enforced.</p>
  {% endif %}

  <div style="display:flex;gap:0.75rem;align-items:center;margin-top:1rem;">
    
    <a class="btn-primary" href="/rooms/create" style="display:inline-block;padding:0.5rem 0.75rem;">Create (Redirect)</a>

    
    <button id="btn-create" style="padding:0.5rem 0.75rem;">Create (AJAX)</button>
  </div>

  <p id="create-result" style="margin-top:1rem;"></p>

  <hr style="margin:2rem 0;">
  <p>Already have a room? <a href="/rooms/join">Join here</a>.</p>
</section>
{% endblock %}

{% block scripts %}
<script>
  const btn = document.getElementById('btn-create');
  const out = document.getElementById('create-result');
  if (btn) {
    btn.addEventListener('click', async () => {
      out.textContent = 'Creating...';
      try {
        const res = await fetch('/api/rooms', { method: 'POST' });
        if (!res.ok) {
          out.textContent = 'Error: ' + (await res.text());
          return;
        }
        const data = await res.json(); // { code: "ABC123" }
        window.location.href = `/rooms/${data.code}`;
      } catch (e) {
        out.textContent = 'Network error: ' + e;
      }
    });
  }
</script>
{% endblock %}
